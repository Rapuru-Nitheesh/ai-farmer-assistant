streamlit
import streamlit as st

# =====================================================
# APP CONFIG
# =====================================================
st.set_page_config(page_title="AI Farmer Assistant", page_icon="üåæ")
st.title("üåæ AI Farmer Assistant")
st.write("AI-based Multi-Rule Decision Support System for Agriculture & Rural Communities")

# =====================================================
# INPUT SECTION (FRONTEND)
# =====================================================
st.subheader("üßæ Farmer Input Details")

soil = st.selectbox("Soil Type", ["Black", "Red", "Alluvial", "Sandy"])
season = st.selectbox("Season", ["Kharif", "Rabi", "Zaid"])
duration = st.selectbox(
    "Crop Duration",
    ["Short (2‚Äì3 months)", "Medium (3‚Äì5 months)", "Long (5+ months)"]
)
water = st.selectbox("Water Availability", ["Low", "Medium", "High"])

# =====================================================
# PRIMARY AI: CROP RECOMMENDATION (RULE-BASED EXPERT SYSTEM)
# =====================================================
def recommend_crop(soil, season, duration, water):
    if soil == "Alluvial" and water == "High":
        return "Rice"
    elif soil == "Black" and season == "Kharif" and duration == "Long (5+ months)":
        return "Cotton"
    elif soil == "Red" and season == "Rabi":
        return "Groundnut"
    elif soil == "Black" and season == "Rabi":
        return "Wheat"
    elif soil == "Sandy" and water == "Low":
        return "Millets"
    elif soil == "Alluvial" and season == "Kharif":
        return "Sugarcane"
    elif soil == "Red" and duration == "Short (2‚Äì3 months)":
        return "Pulses"
    elif soil == "Black" and duration == "Medium (3‚Äì5 months)":
        return "Soybean"
    elif soil == "Sandy" and season == "Zaid":
        return "Sunflower"
    else:
        return "Maize"

# =====================================================
# KNOWLEDGE BASE (EXPANDED)
# =====================================================
knowledge_base = {
    "Rice": {
        "price": "‚Çπ2200‚Äì2400 / quintal",
        "trend": "Increasing",
        "base_budget": 28000,
        "fertilizers": ["Urea", "DAP", "Potash"],
        "advice": "Maintain standing water and control stem borer."
    },
    "Wheat": {
        "price": "‚Çπ2100‚Äì2300 / quintal",
        "trend": "Stable",
        "base_budget": 24000,
        "fertilizers": ["Urea", "DAP"],
        "advice": "Timely irrigation and rust disease monitoring required."
    },
    "Cotton": {
        "price": "‚Çπ6300‚Äì6700 / quintal",
        "trend": "Stable",
        "base_budget": 40000,
        "fertilizers": ["NPK", "Zinc", "Urea"],
        "advice": "Monitor bollworms and avoid excess irrigation."
    },
    "Maize": {
        "price": "‚Çπ2000‚Äì2200 / quintal",
        "trend": "Stable",
        "base_budget": 24000,
        "fertilizers": ["Urea", "DAP"],
        "advice": "Split fertilizer application; control fall armyworm."
    },
    "Groundnut": {
        "price": "‚Çπ5000‚Äì5400 / quintal",
        "trend": "Decreasing",
        "base_budget": 30000,
        "fertilizers": ["Gypsum", "SSP", "Potash"],
        "advice": "Ensure drainage and apply gypsum at flowering stage."
    },
    "Millets": {
        "price": "‚Çπ2800‚Äì3200 / quintal",
        "trend": "Increasing",
        "base_budget": 17000,
        "fertilizers": ["Compost", "Low-dose NPK"],
        "advice": "Low water crop; suitable for dry regions."
    },
    "Sugarcane": {
        "price": "‚Çπ340‚Äì380 / quintal",
        "trend": "Stable",
        "base_budget": 50000,
        "fertilizers": ["Urea", "DAP", "Potash"],
        "advice": "Adequate irrigation and early shoot borer control required."
    },
    "Pulses": {
        "price": "‚Çπ6000‚Äì6500 / quintal",
        "trend": "Increasing",
        "base_budget": 20000,
        "fertilizers": ["DAP", "Rhizobium culture"],
        "advice": "Avoid excess nitrogen; improves soil fertility."
    },
    "Soybean": {
        "price": "‚Çπ4200‚Äì4600 / quintal",
        "trend": "Stable",
        "base_budget": 28000,
        "fertilizers": ["DAP", "Potash"],
        "advice": "Proper drainage and pest monitoring required."
    },
    "Sunflower": {
        "price": "‚Çπ5500‚Äì6000 / quintal",
        "trend": "Increasing",
        "base_budget": 22000,
        "fertilizers": ["Urea", "DAP"],
        "advice": "Maintain soil moisture and control leaf spot disease."
    }
}

# =====================================================
# SECONDARY AI: RISK ANALYSIS (MULTI-RULE)
# =====================================================
def risk_analysis(crop, water, duration):
    risks = []

    if crop in ["Rice", "Sugarcane"] and water == "Low":
        risks.append("‚ö†Ô∏è High water requirement crop with low water availability.")

    if crop in ["Cotton", "Sugarcane"] and duration == "Short (2‚Äì3 months)":
        risks.append("‚ö†Ô∏è Crop duration is insufficient for this crop.")

    if crop in ["Millets", "Pulses"] and water == "High":
        risks.append("‚ÑπÔ∏è Excess irrigation not required for this crop.")

    if not risks:
        risks.append("‚úÖ No major risk detected for selected conditions.")

    return risks

# =====================================================
# DYNAMIC BUDGET AI (CONDITION-BASED)
# =====================================================
def dynamic_budget(crop, water):
    budget = knowledge_base[crop]["base_budget"]

    if water == "Low":
        budget += 3000  # extra irrigation cost
    elif water == "High":
        budget -= 2000  # natural water availability

    return f"‚Çπ{budget} per acre (adjusted based on water availability)"

# =====================================================
# CONDITIONAL FINAL ADVISORY AI
# =====================================================
def conditional_advice(crop, water, duration):
    advice = knowledge_base[crop]["advice"]

    if water == "Low":
        advice += " Use drip irrigation to conserve water."
    if duration == "Short (2‚Äì3 months)":
        advice += " Prefer early-maturing crop varieties."

    return advice

# =====================================================
# OUTPUT SECTION
# =====================================================
if st.button("üå± Get AI Crop Recommendation"):
    crop = recommend_crop(soil, season, duration, water)
    st.success(f"‚úÖ Recommended Crop: **{crop}**")

    data = knowledge_base[crop]

    st.subheader("üìä Market Analysis & Trends")
    st.write(f"üí∞ Price: {data['price']}")
    st.write(f"üìà Trend: {data['trend']}")

    st.subheader("üí∏ Estimated Budget")
    st.write(dynamic_budget(crop, water))

    st.subheader("üß™ Essential Fertilizers")
    st.write(", ".join(data["fertilizers"]))

    st.subheader("‚ö†Ô∏è Risk & Condition Analysis (AI Reasoning)")
    for r in risk_analysis(crop, water, duration):
        if "‚ö†Ô∏è" in r:
            st.warning(r)
        else:
            st.info(r)

    st.subheader("üåæ Final AI Farmer Recommendations")
    st.success(conditional_advice(crop, water, duration))

# =====================================================
# FOOTER
# =====================================================
st.markdown("---")
st.markdown("**AI for Agriculture & Rural Support | Hackathon Project** üåæü§ñ")
